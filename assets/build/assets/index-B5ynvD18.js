import{j as e,u as s}from"./fields-lEbqKXfy.js";import{d as q,a as h,R as C,L as y,u as B}from"./vendor-Bd2ZL6QG.js";import{s as T,n as p,a as P,f as U,L as G}from"./Layout-CjJK5OT4.js";import{P as x,u as w,B as R,s as j,aC as I,r as N,af as V,w as Y,j as H,b as W,g as M,m as z,k as J,f as K,L as Q,n as E,A as Z,o as ee}from"./index-BQ3U1-jG.js";import{B as se}from"./index--9-3Sden.js";import{T as v}from"./index-jQfJPT21.js";import{B as te,P as oe}from"./index-sBWX2MB_.js";import{F as ae,E as ne}from"./FieldGroupsModal-Dqp9-NEa.js";import{m as c}from"./metaTypes-Bb9tjSPe.js";import{E as re}from"./index-Bf29vF0I.js";import{M as le}from"./index-DYtzcsOi.js";import{u as D,a as ie,b as ce,F as de}from"./index.esm-VK9FF9DZ.js";import{u as ue}from"./index-BixwEkkR.js";import"./index-BZdV6FaX.js";import"./index-CxkIX2FA.js";const L=({taxonomy:t,page:m,perPage:b})=>{const{reset:f}=D(),r=w();q();const[n,a]=h.useState(!1),k=()=>{r(I(t)).then(u=>{const i=u.payload;i.success?(f(),a(!n),T("Taxonomy successfully deleted."),N()):p.error(i.error)}).catch(u=>{p.error(u)})},d=[e.jsx(R,{style:j.DANGER,onClick:()=>{k()},children:s("Yes, delete it")}),e.jsx(R,{style:j.SECONDARY,onClick:()=>{a(!n)},children:s("Return back to list")})];return e.jsxs(C.Fragment,{children:[e.jsx(le,{title:s("Delete Taxonomy"),buttons:d,visible:n,children:e.jsx("div",{children:s("You are going to delete this taxonomy. Are you sure?")})}),e.jsx("a",{className:`color-${j.DANGER}`,href:"#",onClick:u=>{u.preventDefault(),a(!n)},children:s("Delete")})]})};L.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,taxonomy:x.string.isRequired};const S=h.memo(({record:t,page:m,perPage:b})=>{const{register:f}=D(),r=`elements.${t.slug}`,n=()=>{Y("duplicateAction",{belongsTo:c.TAXONOMY,find:t.slug}).then(a=>{a.success===!0?(T("Taxonomy successfully duplicated."),P(),N()):p.error(a.error)}).catch(a=>{console.error(a),p.error(s("Unknown error, please retry later"))})};return e.jsx(C.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:r,"data-cy":`select-${t.slug}`,children:[e.jsx("input",{type:"checkbox",id:r,name:r,defaultChecked:!1,...f(r)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.slug}),e.jsx("td",{children:e.jsx(re,{element:t})}),e.jsx("td",{children:V(t,"customPostTypes")&&t.customPostTypes.length>0?e.jsx(y,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Manage")}):e.jsx(y,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Associate")})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(y,{to:`/register_meta?belongsTo=${c.TAXONOMY}&find=${t.slug}`,children:s("Create")}),e.jsx(ae,{find:t.slug,belongsTo:c.TAXONOMY})]})}),e.jsx("td",{children:!t.isNative&&e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("a",{href:`#/view_taxonomy/${t.slug}`,children:s("View")}),e.jsx("a",{href:`#/edit_taxonomy/${t.slug}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),n()},children:s("Duplicate")}),e.jsx(L,{page:m,perPage:b,taxonomy:t.slug}),e.jsx(ne,{belongsTo:c.TAXONOMY,find:t.slug})]})})]})})});S.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,record:x.object.isRequired};const me=()=>{const t=document.globals,m=t.settings;H(c.TAXONOMY);const[b,f]=h.useReducer(o=>o+1,0);ue();const r=h.useRef(),n=ie({mode:"all"}),a=ce({control:n.control,name:"elements"}),k=w(),{data:d,loading:u}=W(o=>o.fetchTaxonomies),{page:i}=B(),A=m.length>0&&M(m,"key","records_per_page")!==""?M(m,"key","records_per_page").value:20,O=Math.ceil(d.count/A);h.useEffect(()=>{z(s("Registered Taxonomies")),J("#/taxonomies"),k(K({page:i||1,perPage:A})).then(o=>{U()})},[i]),h.useEffect(()=>{(()=>{if(!a)return!1;let l=0;for(const[g,X]of Object.entries(a))X===!0&&l++;return l===Object.entries(a).length})()?r.current.checked=!0:r.current&&(r.current.checked=!1)},[a]),document.addEventListener("restoredElement",function(){f()});const F=o=>{n.reset(),o.belongsTo=c.TAXONOMY;const l=o.action;if(l)switch(l){case"hide":ee(o);break;case"delete":case"duplicate":Y("bulkActionsAction",o).then(g=>{if(g.success===!0){switch(o.action){case"delete":T("Taxonomy successfully deleted.");break;case"duplicate":T("Taxonomy successfully duplicated.");break}P(),N()}else p.error(g.error)}).catch(g=>{console.error(g),p.error(s("Unknown error, please retry later"))});break}},_=o=>{d.records.filter(l=>l.isNative===!1).filter(l=>!E(l.slug,c.TAXONOMY)).map(l=>{n.setValue(`elements.${l.slug}`,o)})},$=[e.jsx(se,{style:j.PRIMARY,to:"/register_taxonomy",children:s("Register new Taxonomy")})];return u?e.jsx(Q,{}):e.jsx(de,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(F),children:e.jsxs(G,{title:s("Registered Taxonomies"),actions:$,crumbs:[{label:s("Registered Taxonomies")}],children:[e.jsx(te,{belongsTo:c.TAXONOMY}),d.records&&d.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table ${t.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:r,type:"checkbox",id:"all",defaultChecked:!1,onClick:o=>_(o.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{children:e.jsx(v,{tip:s("Taxonomy slug. The post name/slug. Used for various queries for taxonomy content."),label:s("Slug")})}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(v,{tip:s("Associate custom post types here"),label:s("Associated post types")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:d.records&&d.records.map(o=>{if(!E(o.slug,c.TAXONOMY))return e.jsx(S,{record:o,page:i,perPage:A},o.id)})}),O>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx(oe,{currentPage:i?parseInt(i):1,totalPages:O,baseLink:"/taxonomies"})})})})]})}):e.jsxs(Z,{style:j.SECONDARY,children:[s("No taxonomies found.")," ",e.jsx(y,{to:"/register_taxonomy",children:s("Register the first one")}),"!"]})]})})})};me.propTypes={};export{me as default};
