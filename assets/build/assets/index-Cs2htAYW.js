import{j as e,u as s}from"./fields-PF-HBT_1.js";import{a as u,R as A,L as y,u as V}from"./vendor-Bd2ZL6QG.js";import{s as N,n as P,a as $,f as H,L as z}from"./Layout-Dmz1SQGO.js";import{P as C,g as w,u as L,B as R,s as p,A as M,ae as J,r as _,af as D,w as O,b as K,m as Q,c as X,L as Z,n as F,o as ee}from"./index-BeA13JTg.js";import{T as Y}from"./index-zHOaqjWK.js";import{E as se}from"./index-CT6OhVxr.js";import{E as te}from"./index-CQ9j9_Hp.js";import{F as oe,E as le}from"./FieldGroupsModal-DNTiRKzr.js";import{m as g}from"./metaTypes-Bb9tjSPe.js";import{M as U}from"./index-w9ySzMv3.js";import{u as W,a as ne,b as ae,F as re}from"./index.esm-VK9FF9DZ.js";import{B as ce,P as ie}from"./index-3eb8lPoX.js";import{B as de}from"./index-C3RXc1bj.js";import{u as me}from"./index-BixwEkkR.js";import"./index-BBTKUrXA.js";import"./index-Ss1gle6Z.js";const q=({postType:t,page:j,perPage:d})=>{const x=document.globals.settings,c=w(x,"key","delete_posts").value,{reset:i}=W(),n=L(),[f,a]=u.useState(!1),k=()=>{n(J(t,"all")).then(m=>{const o=m.payload;o.success?(i(),a(!f),N("Custom post type successfully deleted."),_()):P.error(o.error)}).catch(m=>{P.error(m)})},h=[e.jsx(R,{style:p.DANGER,onClick:()=>{k()},children:s("Yes, delete it")}),e.jsx(R,{style:p.SECONDARY,onClick:()=>{a(!f)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsxs(U,{title:s("Delete custom post type"),buttons:h,visible:f,children:[e.jsx("div",{children:s("You are going to delete this custom post type. Are you sure?")}),c&&e.jsx("div",{className:"mt-24",children:e.jsx(M,{style:p.WARNING,children:s("WARNING: This action will delete all posts and metadata for this post type. The action is irreversible.")})})]}),e.jsx("a",{href:"#",className:`color-${p.DANGER}`,onClick:m=>{m.preventDefault(),a(!f)},children:s("Delete")})]})};q.propTypes={page:C.number.isRequired,perPage:C.number.isRequired,postType:C.string.isRequired};const B=u.memo(({record:t,showWooCommerceColumn:j,page:d,perPage:b})=>{const{register:x}=W(),c=`elements.${t.name}`,i=()=>{O("duplicateAction",{belongsTo:g.CUSTOM_POST_TYPE,find:t.name}).then(n=>{n.success===!0?(N("Custom post type successfully duplicated."),$(),_()):P.error(n.error)}).catch(n=>{console.error(n),P.error(s("Unknown error, please retry later"))})};return e.jsx(A.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:c,"data-cy":`select-${t.name}`,children:[e.jsx("input",{type:"checkbox",id:c,name:c,defaultChecked:!1,...x(c)}),e.jsx("span",{})]})}),e.jsx("td",{children:e.jsx(se,{value:t.icon})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:e.jsx(te,{element:t})}),e.jsx("td",{children:D(t,"taxonomies")&&t.taxonomies.length>0?e.jsx(y,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Manage")}):e.jsx(y,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Associate")})}),j&&e.jsx("td",{children:t.isWooCommerce===!0&&e.jsx(A.Fragment,{children:D(t,"woocommerceProductData")&&t.woocommerceProductData.length>0?e.jsx(y,{to:`/product-data/${t.name}`,children:s("Manage")}):e.jsx(y,{to:`/product-data/${t.name}`,children:s("Create")})})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(y,{to:`/register_meta?belongsTo=${g.CUSTOM_POST_TYPE}&find=${t.name}`,children:s("Create")}),e.jsx(oe,{find:t.name,belongsTo:g.CUSTOM_POST_TYPE})]})}),e.jsx("td",{children:!t.isNative&&e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(y,{to:`view/${t.name}`,children:s("View")}),e.jsx(y,{to:`edit/${t.name}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),i()},children:s("Duplicate")}),e.jsx(q,{page:d,perPage:b,postType:t.name}),e.jsx(le,{belongsTo:g.CUSTOM_POST_TYPE,find:t.name})]})})]})})});B.propTypes={page:C.number.isRequired,perPage:C.number.isRequired,record:C.object.isRequired,showWooCommerceColumn:C.bool.isRequired};const ue=()=>{const j=document.globals.globals,[d,b]=u.useState(!1),[x,c]=u.useState([]),[i,n]=u.useState(!1),[f,a]=u.useState([]);u.useEffect(()=>{d===!0&&(n(!0),O("fetchPostTypesAction",{}).then(o=>{c(o),n(!1)}).catch(o=>{console.error(o.message),n(!1)}))},[d]);const k=()=>{O("syncPostsAction",{postTypes:f}).then(o=>{o.success&&(N("Successfully post sync."),_()),o.error&&P.error(error),b(!d)}).catch(o=>{console.error(o.message)})},h=(o,S)=>{a(S===!0?T=>[...T,o]:T=>T.filter(v=>v!==o))},m=[e.jsx(R,{style:p.PRIMARY,disabled:f.length===0,onClick:()=>{k()},children:s("Sync")}),e.jsx(R,{style:p.SECONDARY,onClick:()=>{b(!d)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsx(U,{title:s("Sync with post types"),buttons:m,visible:d,children:i?e.jsx("div",{children:"Loading..."}):e.jsx(A.Fragment,{children:x&&x.length>0?e.jsx("div",{className:"responsive",children:e.jsx("table",{className:`acpt-table spaceless ${j.is_rtl?"rtl":""}`,children:e.jsx("tbody",{children:x.map(o=>e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:`select_${o.name}`,children:[e.jsx("input",{name:`select_${o.name}`,defaultChecked:!1,type:"checkbox",id:`select_${o.name}`,onChange:S=>h(o.name,S.target.checked)}),e.jsx("span",{children:o.label})]})})}))})})}):e.jsx(M,{style:p.SECONDARY,children:s("No custom post type found.")})})}),e.jsx(R,{type:"button",style:p.SECONDARY,onClick:o=>{o.preventDefault(),b(!d)},children:s("Sync with post types")})]})},Ne=()=>{const t=document.globals,j=t.settings,d=t.globals,[b,x]=u.useReducer(l=>l+1,0);me();const c=u.useRef(),i=ne({mode:"all"}),n=ae({control:i.control,name:"elements"}),f=L(),{data:a,loading:k}=K(l=>l.fetchCustomPostTypes),{page:h}=V(),m=j.length>0&&w(j,"key","records_per_page")!==""?w(j,"key","records_per_page").value:20,o=Math.ceil(a.count/m);u.useEffect(()=>{Q(s("Registered Custom Post Types")),f(X({page:h||1,perPage:m})).then(l=>{H()})},[h]),u.useEffect(()=>{(()=>{if(!n)return!1;let r=0;for(const[E,I]of Object.entries(n))I===!0&&r++;return r===Object.entries(n).length})()?c.current.checked=!0:c.current&&(c.current.checked=!1)},[n]),document.addEventListener("restoredElement",function(){x()});const S=l=>{i.reset(),l.belongsTo=g.CUSTOM_POST_TYPE;const r=l.action;if(r){switch(r){case"hide":ee(l);break;case"delete":case"duplicate":O("bulkActionsAction",l).then(E=>{if(E.success===!0){switch(r){case"delete":N("Custom post type successfully deleted.");break;case"duplicate":N("Custom post type successfully duplicated.");break}$(),_()}else P.error(E.error)}).catch(E=>{console.error(E),P.error(s("Unknown error, please retry later"))});break}i.resetField("elements")}},T=()=>{if(!a.records)return!1;let l=0;return a.records.map(r=>{r.isWooCommerce===!0&&l++}),l>0},v=l=>{a.records.filter(r=>r.isNative===!1).filter(r=>!F(r.name,g.CUSTOM_POST_TYPE)).map(r=>{i.setValue(`elements.${r.name}`,l)})},G=[e.jsx(de,{style:p.PRIMARY,to:"/register",children:s("Register new Post Type")}),e.jsx(ue,{})];return k?e.jsx(Z,{}):e.jsx(re,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(S),children:e.jsxs(z,{title:s("Registered Custom Post Types"),actions:G,crumbs:[{label:s("Registered Custom Post Types")}],children:[e.jsx(ce,{belongsTo:g.CUSTOM_POST_TYPE}),a.records&&a.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table ${d.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:c,type:"checkbox",id:"all",defaultChecked:!1,onClick:l=>v(l.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(Y,{tip:s("Associated taxonomies with the post"),label:s("Associated taxonomies")})}),T()&&e.jsx("th",{children:e.jsx(Y,{tip:s("Associated WooCommerce product data"),label:s("Product data")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:a.records&&a.records.map(l=>{if(!F(l.name,g.CUSTOM_POST_TYPE))return e.jsx(B,{record:l,page:h,perPage:m,showWooCommerceColumn:T()},l.id)})}),o>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:T()?8:7,children:e.jsx(ie,{currentPage:h?parseInt(h):1,totalPages:o,baseLink:""})})})})]})}):e.jsxs(M,{style:p.SECONDARY,children:[s("No custom post types found.")," ",e.jsx(y,{to:"/register",children:s("Register the first one")}),"!"]})]})})})};export{Ne as default};
