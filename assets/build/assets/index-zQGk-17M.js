import{j as e,u as t}from"./fields-PF-HBT_1.js";import{a as y,R as q,u as De,d as we}from"./vendor-Bd2ZL6QG.js";import{u as F,c as L,b as R,g as se,a as Fe,F as Ce}from"./index.esm-VK9FF9DZ.js";import{u as C,B as w,s as N,ag as Se,ah as te,P as f,ai as Re,I as T,A as ke,E as G,aj as Te,b as E,ak as ae,al as le,am as ne,an as $,y as Y,z as Ee,ao as Ae,ap as qe,aq as ie,a4 as Ie,aa as Ve,m as Le,k as Oe,ar as $e,as as Pe,L as Me,i as We,at as Be}from"./index-ODfWKAEk.js";import{b as P,u as ee,B as Ge,L as Ye,n as B}from"./Layout-DsqMYg_l.js";import{M as _}from"./index-CNJ1yMTZ.js";import{P as _e}from"./index-BI-Df3ef.js";import{I as H}from"./InputHidden-CmRMEDFG.js";import{u as re}from"./index-BixwEkkR.js";import{u as M,C as W,S as z,M as de,B as He,L as O,a as oe}from"./index-D0SIHoSs.js";import{S as ce}from"./Select-C7VByP_u.js";import{I}from"./Input-BfCLeQor.js";import{T as V}from"./index-DTyMbM9L.js";const ze=()=>{const s=C(),{setValue:o}=F(),[d,l]=y.useState(!1),i=[e.jsx(w,{style:N.SUCCESS,onClick:r=>{r.preventDefault(),s(Se()),s(te()),o("fields",[]),l(!d)},children:t("Yes")}),e.jsx(w,{style:N.DANGER,onClick:r=>{r.preventDefault(),l(!d)},children:t("No")})];return e.jsxs(q.Fragment,{children:[e.jsx(_,{title:t("Confirm deleting all"),visible:d,buttons:i,children:t("Are you sure?")}),e.jsx(w,{style:N.DANGER,onClick:r=>{r.preventDefault(),l(!d)},children:t("Delete all")})]})},Ue="Date",Qe="Email",ue="Select",U="Text",Xe="Textarea",me=[{value:Ue,label:"Date"},{value:Qe,label:"Email"},{value:ue,label:"Select"},{value:U,label:"Text"},{value:Xe,label:"Textarea"}],he=({fieldIndex:s,optionIndex:o})=>{const d=C(),l=()=>`fields.${s}.options`,{control:i}=F(),{remove:r}=L({control:i,name:l()}),[p,x]=y.useState(!1),a=[e.jsx(w,{style:N.SUCCESS,onClick:n=>{n.preventDefault(),d(Re({fieldIndex:s,optionIndex:o})),r(o),x(!p)},children:t("Yes")}),e.jsx(w,{style:N.DANGER,onClick:n=>{n.preventDefault(),x(!p)},children:t("No")})];return e.jsxs("span",{children:[e.jsx(_,{title:t("Confirm deleting option"),visible:p,buttons:a,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),x(!p)},children:e.jsx(V,{icon:!1,tip:t("Delete"),label:e.jsx(T,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};he.propTypes={fieldIndex:f.number.isRequired,optionIndex:f.number.isRequired};const xe=y.memo(({index:s,fieldIndex:o,fieldId:d,option:l})=>{const i=g=>`fields.${o}.options.${s}.${g}`,{register:r,formState:{errors:p},control:x,setValue:a}=F(),n=R({control:x,name:i("value")}),h=R({control:x,name:i("label")}),{attributes:b,listeners:u,setNodeRef:m,transform:c}=M({id:l.id}),j={transform:W.Translate.toString(c)},[D,S]=y.useState(l.label===l.value),k=()=>n||(l.value?l.value:null),v=()=>h||(l.label?l.label:null);return e.jsxs("div",{className:"i-flex-center s-8",style:j,ref:m,children:[e.jsx(H,{id:i("id"),value:l.id,register:r}),e.jsx("span",{className:"cursor-move top-2 handle",...b,...u,children:e.jsx(T,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsxs("span",{className:"i-flex-center s-24 w-100",children:[e.jsx("span",{className:"w-100",children:e.jsx(I,{id:i("label"),register:r,errors:p,defaultValue:v(),onChangeCapture:g=>{D&&a(i("value"),g.target.value)},onClick:g=>{l.label&&g.target.value==="option"&&a(i("label"),null)},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("span",{children:e.jsx("button",{type:"button",className:`acpt-btn-switch ${D?"active":""}`,onClick:g=>{g.preventDefault(),S(!D)},children:e.jsx(T,{icon:"bx:bx-link",width:"18px"})})}),e.jsx("span",{className:"w-100",children:e.jsx(I,{id:i("value"),register:r,errors:p,defaultValue:k(),onChangeCapture:g=>{D&&a(i("label"),g.target.value)},onClick:g=>{l.value&&g.target.value==="option"&&a(i("value"),null)},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx(he,{fieldIndex:o,optionIndex:s})]})]})});xe.propTypes={fieldId:f.string.isRequired,index:f.number.isRequired,fieldIndex:f.number.isRequired,option:f.object.isRequired};const pe=({fieldId:s,fieldIndex:o,options:d})=>{const l=C(),i=()=>`fields.${o}.options`,{control:r}=F(),{move:p}=L({control:r,name:i()}),x=n=>{const{active:h,over:b}=n;if(h.id===b.id)return;const u=d.findIndex(c=>c.id===h.id),m=d.findIndex(c=>c.id===b.id);p(u,m)},a=()=>{const n={id:G(),fieldId:s,label:"option",value:"option"};l(Te({fieldIndex:o,option:n}))};return e.jsx("div",{children:e.jsxs("fieldset",{className:"acpt-fieldset",children:[e.jsx("legend",{children:t("Option list")}),d&&d.length>0?e.jsx(z,{onDragEnd:x,items:d,children:e.jsx("div",{className:"flex-column s-24",children:d&&d.map((n,h)=>e.jsx(xe,{index:h,fieldIndex:o,fieldId:s,option:n}))})}):e.jsx(ke,{style:N.WARNING,children:t('No options already created. Create the first one now by clicking the button "Add option"!')}),e.jsx("div",{className:"i-flex-center s-8 mt-24",children:e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),a()},children:t("Add option")})})]})})};pe.propTypes={fieldId:f.string.isRequired,fieldIndex:f.number.isRequired,options:f.array.isRequired};const Q=({element:s})=>{const o=C(),{selectedElements:d}=E(i=>i.productDataFieldsState),l=()=>d.filter(r=>r.id===s.id).length>0;return e.jsx(V,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${s.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${s.id}`,type:"checkbox",checked:l(),onChange:i=>{o(ae({element:s,selected:i.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:t(l()?"Deselect this element":"Select this element")})};Q.propTypes={element:f.object.isRequired};const fe=({field:s,index:o})=>{const d=C(),{control:l}=F(),{remove:i}=L({control:l,name:"fields"}),[r,p]=y.useState(!1),x=[e.jsx(w,{style:N.SUCCESS,onClick:a=>{a.preventDefault(),d(le({field:s})),i(o),p(!r)},children:t("Yes")}),e.jsx(w,{style:N.DANGER,onClick:a=>{a.preventDefault(),p(!r)},children:t("No")})];return e.jsxs(q.Fragment,{children:[e.jsx(_,{title:t("Confirm deleting option"),visible:r,buttons:x,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),p(!r)},children:e.jsx(T,{icon:"bx-trash",width:18,color:"#F94144"})})]})};fe.propTypes={index:f.number.isRequired,field:f.object.isRequired};const X=({field:s,index:o})=>{const d=C(),{closedElements:l}=E(a=>a.productDataFieldsState),{control:i}=F(),{append:r}=L({control:i,name:"fields"}),p=()=>l.filter(n=>n===s.id).length===1,x=()=>{Ee(s.id),p()?d(Ae({id:s.id})):d(qe({id:s.id}))};return e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx(V,{label:e.jsx("a",{href:"#",onClick:a=>{a.preventDefault();const n=ne(s);d($({field:n})),r(n),Y(1).then(()=>{P(n.id)})},children:e.jsx(T,{icon:"bx:duplicate",width:18})}),tip:t("Duplicate this meta field"),icon:!1}),e.jsx(V,{label:e.jsx(fe,{index:o,field:s}),tip:t("Delete this meta field"),icon:!1}),e.jsx(V,{label:e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),x()},children:e.jsx(T,{icon:"bx:expand-alt",width:18})}),tip:t("Hide/show this meta field"),icon:!1})]})};X.propTypes={index:f.number.isRequired,field:f.object.isRequired};const je=({field:s,index:o})=>{const{attributes:d,listeners:l,setNodeRef:i,isDragging:r,transform:p}=M({id:s.id}),x={transform:W.Translate.toString(p)};C(),E(v=>v.productDataFieldsState);const{register:a,formState:{errors:n},control:h,setValue:b}=F(),u=v=>`fields.${o}.${v}`,m=R({control:h,name:u("name")}),c=R({control:h,name:u("type")}),j=R({control:h,name:u("isRequired")}),D=()=>{const v=u("name"),g=se(n,v);return g?e.jsx("span",{className:"invalid-feedback",children:t(g.message)}):m||s.name},S=()=>c||s.type,k=v=>v===ue;return e.jsx("tr",{id:s.id,ref:i,style:x,className:`bg-white ${r?"b-rounded z-100 with-drop-shadow":""}`,children:e.jsxs("td",{style:{background:"#eff6fc3b"},className:"with-active-border",colSpan:4,children:[e.jsx(H,{id:u("id"),value:s.id,register:a}),e.jsx("div",{className:"mb-24",children:e.jsxs("div",{className:"flex-between s-8 for-xs",children:[e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...d,...l,children:e.jsx(T,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(Q,{element:{id:s.id}}),e.jsx("h3",{children:D()}),e.jsx("span",{className:"color-gray",children:e.jsx(de,{fieldType:S(),css:"top-2"})}),e.jsx("span",{className:"i-flex-center s-8",children:e.jsx(V,{label:e.jsx(q.Fragment,{children:e.jsx(He,{control:h,defaultValue:typeof j=="boolean"?j:s.isRequired,errors:n,icon:"foundation:asterisk",id:u("isRequired")})}),tip:t("Field required"),icon:!1})})]}),e.jsx(X,{field:s,index:o})]})}),e.jsx("div",{className:"bg-white with-border b-rounded p-24",children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(O,{isRequired:!0,id:u("name"),label:t("Name")}),e.jsx(I,{id:u("name"),register:a,errors:n,placeholder:t("Name"),defaultValue:s.name,onClick:v=>{s.name&&v.target.value==="field"&&b(u("name"),null)},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(O,{isRequired:!0,id:u("type"),label:t("Field type")}),e.jsx(ce,{register:a,errors:n,id:u("type"),values:me})]})]}),e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(O,{isRequired:!1,id:u("defaultValue"),label:t("Default value")}),e.jsx(I,{id:u("defaultValue"),register:a,errors:n,placeholder:t("Default value"),defaultValue:s.defaultValue,validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(O,{isRequired:!1,id:u("description"),label:t("A brief description")}),e.jsx(I,{id:u("description"),register:a,errors:n,placeholder:t("A brief description"),defaultValue:s.description,validate:{maxLength:{value:255,message:"max length is 255"}}})]})]}),k(S())&&e.jsx(pe,{fieldId:s.id,fieldIndex:o,options:s.options?s.options:[]})]})})]})})};je.propTypes={index:f.number.isRequired,field:f.object.isRequired};const ge=({field:s,index:o})=>{const{attributes:d,listeners:l,setNodeRef:i,isDragging:r,transform:p}=M({id:s.id}),x={transform:W.Translate.toString(p)};C(),E(A=>A.productDataFieldsState);const{register:a,formState:{errors:n},control:h,setValue:b}=F(),u=A=>`fields.${o}.${A}`,m=R({control:h,name:u("name")}),c=R({control:h,name:u("type")});R({control:h,name:u("isRequired")});const j=()=>{const A=u("name"),Z=se(n,A);return Z?e.jsx("span",{className:"invalid-feedback",children:t(Z.message)}):m||s.name},D=()=>c||s.type,[S,k]=y.useState(!1),[v,g]=y.useState(!1),K=y.useRef(),J=y.useRef();return ee([K],()=>{g(!1)}),ee([J],()=>{k(!1)}),e.jsx(q.Fragment,{children:e.jsxs("tr",{id:s.id,ref:i,style:x,className:`bg-white b-rounded ${r?"z-100 with-drop-shadow":""}`,children:[e.jsx("td",{children:e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move handle top-2",...d,...l,children:e.jsx(T,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(Q,{element:{id:s.id}})]})}),e.jsx("td",{children:S?e.jsx("div",{ref:J,style:{maxWidth:"200px"},children:e.jsx(I,{id:u("name"),register:a,errors:n,placeholder:t("Name"),defaultValue:s.name,onClick:A=>{s.name&&A.target.value==="field"&&b(u("name"),null)},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}):e.jsx("div",{className:"i-flex-center s-8 cursor-pointer",onClick:()=>{window.innerWidth>=960&&k(!S)},children:j()})}),e.jsx("td",{children:v?e.jsx("div",{ref:K,style:{maxWidth:"200px"},children:e.jsx(ce,{register:a,id:u("type"),errors:n,defaultValue:s.type,values:me})}):e.jsx("div",{className:"i-flex-center s-8 cursor-pointer",onClick:()=>{window.innerWidth>=960&&g(!v)},children:e.jsx(de,{fieldType:D(),css:"with-border b-rounded p-8"})})}),e.jsx("td",{children:e.jsx(X,{field:s,index:o})})]})})};ge.propTypes={index:f.number.isRequired,field:f.object.isRequired};const be=({field:s,index:o})=>{const{closedElements:d}=E(i=>i.productDataFieldsState);return d.filter(r=>r===s.id).length===1?e.jsx(ge,{field:s,index:o}):e.jsx(je,{field:s,index:o})};be.propTypes={index:f.number.isRequired,field:f.object.isRequired};const Ke=()=>{const s=C(),{selectedElements:o}=E(h=>h.productDataFieldsState),{control:d,setValue:l,getValues:i}=F(),r=R({control:d,name:"fields"}),p=y.useRef(null),[x,a]=y.useState(null),n=()=>{o.map(h=>{const b=r.findIndex(m=>m.id===h.id),u=r[b];switch(x){case"duplicate":const m=ne(u);r.push(m),l("fields",r),s($({field:m}));break;case"delete":const c={...u},j=i("fields").filter(D=>D.id!==h.id);l("fields",j),s(le({field:c}));break}}),(x==="delete"||x==="duplicate")&&s(te()),p.current.value=""};return e.jsx(q.Fragment,{children:o.length>0&&e.jsxs("div",{className:"flex-between mb-24",children:[e.jsxs("div",{children:[o.length," ",t("Selected items")]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:p,className:"form-control sm",onChange:h=>{a(h.target.value!==""?h.target.value:null)},children:[e.jsx("option",{value:"",children:t("Select")}),e.jsx("option",{value:"duplicate",children:t("Duplicate")}),e.jsx("option",{value:"delete",children:t("Delete")})]}),e.jsx(w,{style:N.WHITE,size:"sm",disabled:x===null,onClick:h=>{h.preventDefault(),n()},children:t("Execute")})]})]})})},ve=({field:s,index:o})=>{const{control:d}=F(),l=R({control:d,name:`fields.${o}.name`}),{attributes:i,listeners:r,setNodeRef:p,isDragging:x,transform:a}=M({id:s.id}),n={transform:W.Translate.toString(a)};return e.jsxs("div",{className:"tree-el flex-between s-8",ref:p,style:n,children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...i,...r,children:e.jsx(T,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx("span",{className:"text-ellipsis cursor-pointer",onClick:h=>{h.preventDefault(),P(`${s.id}`)},children:l||s.name})]}),e.jsx(Ge,{style:N.SECONDARY,children:"F"})]},s.id)};ve.propTypes={field:f.object.isRequired,index:f.number.isRequired};const ye=({fields:s})=>{const d=document.globals.globals;if(s.length===0)return null;const l=C(),{control:i}=F(),{move:r}=L({control:i,name:"fields"}),p=x=>{const{active:a,over:n}=x;if(a.id===n.id)return;const h=s.findIndex(m=>m.id===a.id),b=s.findIndex(m=>m.id===n.id),u=oe(s,h,b);r(h,b),l(ie(u))};return e.jsxs("div",{className:"b-rounded with-shadow bg-white p-24",children:[e.jsx("h3",{className:"mb-24 flex-between s-8",children:e.jsx("span",{className:"text-ellipsis cursor-pointer",children:t("product data fields")})}),e.jsx("div",{className:`tree ${d.is_rtl===!0?"rtl":""}`,children:e.jsx(z,{onDragEnd:p,items:s,children:e.jsx(q.Fragment,{children:s.length>0&&s.map((x,a)=>e.jsx(ve,{index:a,field:x}))})})})]})};ye.propTypes={fields:f.array.isRequired};const Ne=({fields:s})=>{const o=document.globals;o.settings;const d=o.globals,[l]=re(),i=C(),{control:r}=F(),{move:p}=L({control:r,name:"fields"}),x="wp_product_data",[a,n]=y.useState(Ie(x)),h=c=>{const{active:j,over:D}=c;if(j.id===D.id)return;const S=s.findIndex(g=>g.id===j.id),k=s.findIndex(g=>g.id===D.id),v=oe(s,S,k);p(S,k),i(ie(v))},b=c=>{s&&s.map(j=>{i(ae({element:j,selected:c}))})},u=()=>{const c=G();i($({field:{id:c,name:"field",type:U,isRequired:!1,description:null,defaultValue:null,options:[]}})),Y(1).then(()=>{P(c)})},m=c=>{Ve(x,c),n(!a)};return e.jsxs(q.Fragment,{children:[e.jsxs("div",{className:`flex-between s-8 ${s.length===0?" mb-12":""}`,children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("h3",{children:t("product data fields")}),e.jsx("span",{className:"px-8 py-4 font-sm bg-light-gray text-normal b-rounded",children:s.length>0?s.length:0})]}),s.length>0&&e.jsxs("div",{className:"i-flex-center s-8 mb-24",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_navigation",className:"toggle",children:[e.jsx("input",{id:"toggle_navigation",type:"checkbox",checked:a,onChangeCapture:c=>{m(c.target.checked)}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_navigation",children:t(a?"Hide navigation":"Show navigation")})]})]}),e.jsx(Ke,{}),s&&s.length>0?e.jsxs("div",{className:"container",children:[a&&e.jsx("div",{className:"col-3 flex-column s-24 hidden-xs sticky",style:{top:"130px"},children:e.jsx(ye,{fields:s})}),e.jsx("div",{className:`flex-column s-24 ${a?"col-9":"col-12"}`,children:e.jsxs("div",{className:"responsive with-shadow b-rounded",children:[e.jsxs("table",{className:`acpt-table  ${d.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-fields",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-fields",type:"checkbox",onChange:c=>{b(c.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{children:t("Name")}),e.jsx("th",{children:t("Type")}),e.jsx("th",{children:t("Actions")})]})}),e.jsx("tbody",{ref:l,children:e.jsx(z,{onDragEnd:h,items:s,children:s&&s.map((c,j)=>e.jsx(be,{field:c,index:j}))})})]}),e.jsx("div",{className:"p-24 bg-white",children:e.jsx(w,{type:"button",style:N.SECONDARY,onClick:c=>{c.preventDefault(),u()},children:t("Add field")})})]})})]}):e.jsx("div",{className:"mb-24 p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t('No fields already created. Create the first one now by clicking the button "Add field"!')}),e.jsx("div",{children:e.jsx(w,{type:"button",style:N.SECONDARY,onClick:c=>{c.preventDefault(),u()},children:t("Add field")})})]})})]})};Ne.propTypes={fields:f.array.isRequired};const us=({})=>{const s=C(),{loading:o}=E(m=>m.fetchProductDataFields),{fields:d}=E(m=>m.productDataFieldsState),{id:l}=De(),[i,r]=y.useState(!1),p=we(),[x]=re(),a=Fe({mode:"all"});y.useEffect(()=>{Le(t("Manage product data fields")),Oe("#/"),s($e(l)).then(m=>{s(Pe(m.payload)),m.payload&&m.payload.map((c,j)=>{a.setValue(`fields.${j}`,c)})}).catch(m=>{console.error(m),r(!0)})},[]);const n=()=>{const m=G();s($({field:{id:m,name:"field",type:U,isRequired:!1,description:null,defaultValue:null,options:[]}})),Y(1).then(()=>{P(m)})},h=()=>!(a.formState.errors&&a.formState.errors.pages),b=m=>{s(Be(m)).then(c=>{const j=c.payload;j.success?(p(`/product-data/product/fields/${l}`),B.success(t("WooCommerce product data fields successfully saved"))):B.error(j.error)}).catch(c=>{B.error(c)})},u=[e.jsx(w,{style:N.SECONDARY,onClick:m=>{m.preventDefault(),n()},children:t("Add field")}),e.jsx(w,{disabled:!h(),style:N.PRIMARY,children:t("Save")}),e.jsx(ze,{})];return o?e.jsx(Me,{}):i?e.jsx(_e,{}):e.jsx(Ce,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(b),children:e.jsxs(Ye,{title:t("Manage option pages"),actions:u,crumbs:[{label:t("Registered Custom Post Types"),link:"/"},{label:t("WooCommerce product data"),link:"/product-data/product"},{label:t("product data fields")}],children:[e.jsx(H,{register:a.register,id:"productDataId",value:l}),e.jsx("div",{ref:x,children:e.jsx(Ne,{fields:We(d)?[]:d})})]})})})};export{us as default};
